<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
	
	    <menuitem name="TRIAGE" id="medical_infirmier" parent="mz_medical.medical_salle_soins_root" sequence="1" groups="mz_medical.group_infirmier"/>
						
		<record model="ir.ui.view" id="episode_medical_secretaire_search">
			<field name="name">episode.medical.infirmier.search</field>
			<field name="model">mz.episode.medical</field>
			<field name="arch" type="xml">
				<search string="Episode medical">
					<field name="patient_id" />
					<field name="num_fiche" string="N° Fiche"/>
					<field name="date_inscription" />
					<field name="cree_par" />
					<filter name="en_attente" string="Triage en attente" domain="[('state','=', 'attente_reception_secretaire'),('date_inscription', '>=', datetime.datetime.combine(context_today(), datetime.time(0,0,0)))]"  help="Recherche rapide"/>
				</search>
			</field>
		</record>
		
		<record model="ir.ui.view" id="episode_medical_secretaire_form">
			<field name="name">episode_medical.form</field>
			<field name="model">mz.episode.medical</field>
			<field name="arch" type="xml">
				<form string="Episode medical" create="false">
				    <header>
						<button name="recevoir_secretaire" type="object" string="Reçu" states="attente_reception_secretaire" class="oe_highlight" groups="mz_medical_mokuwa.group_secretaire"/>
					    <field name="state" widget="statusbar" statusbar_visible="confirmee,recu_salle_soins,attente_consultation,consulte"/>
				    </header>
				    <sheet>
					    <div class="oe_button_box" name="button_box">
                            <button name="action_view_actes_prescris" class="oe_stat_button" icon="fa-file-text" string="Actes prescris" type="object" />
                        </div>
						<div class="row">
							<div class="col-lg-8" style="width: 500px;">
								<div class="oe_title">
									<label for="patient_id" class="oe_edit_only"/>
									<h1><field name="patient_id" readonly="1"/></h1>
								</div>
							</div>
                            <div class="col-lg-4" attrs="{'invisible':[('state','=', 'confirmee')]}">
								Reçu(e) : <field name="date_recept_post_infirmier" readonly="1" class="oe_inline"/> <br/>
							    Par : <field name="recept_post_infirmier_par" readonly="1" options="{'no_open': True}" class="oe_inline"/>
							</div>
						</div>
                        
				        <group>
				            <group string="Infos Patient">
							    <field name="sexe"/>
							    <field name="age"/>
							    <field name="etat_civile"/>
								<field name="avenue"/>
								<field name="quartier"/>
								<field name="commune_id"/>
							    <!--field name="telephone"/-->
						    </group>
						    <group string="Infos visite">
							    <field name="name" readonly="1"/>
							    <field name="motif_visite_id" readonly="1" options="{'no_open': True}"/>
							    <field name="observation" readonly="1" />
								<field name="cabinet_destination_id" attrs="{'invisible':[('state','=', 'attente_reception_secretaire')], 'required':[('state','=', 'recu_secretaire')],'readonly':[('state','=', 'consulte')]}"/>
							</group>
					    </group>
					
					</sheet>
				</form>
			</field>
		</record>
		
		<record model="ir.ui.view" id="episode_medical_secretaire_tree">
			<field name="name">episode_medical.tree</field>
			<field name="model">mz.episode.medical</field>
			<field name="arch" type="xml">
				<tree string="Episode medical" decoration-primary="state=='attente_reception_secretaire'" create="false">
					<field name="name" />
					<field name="patient_id" />
					<field name="num_fiche" string="N° Fiche"/>
					<field name="date_inscription" />
					<field name="motif_visite_id" />
					<field name="provenance_id" />
					<field name="cree_par" />
					<field name="state" invisible="1" />
				</tree>
			</field>
		</record>
		
		<record model="ir.actions.act_window" id="action_triage_secretaire">
		    <field name="name">Salle de soin</field>
		    <field name="res_model">mz.episode.medical</field>
			<field name="domain" eval="[('motif_visite_id.categorie_motif_visite','=','Ambulatoire'),
										('state','not in',['nouveau','confirmee','recu_salle_soins'])]"/>
		    <field name="view_mode">tree,form</field>
			<field name="search_view_id" ref="episode_medical_secretaire_search"/>
			<field name="context">{'search_default_en_attente': 'attente_reception',}</field>
	    </record>
		
		<record model="ir.actions.act_window.view" id="action_triage_secretaire_form_view">
		    <field eval="20" name="sequence"/>
		    <field name="view_mode">form</field>
		    <field name="view_id" ref="episode_medical_secretaire_form"/>
		    <field name="act_window_id" ref="action_triage_secretaire"/>
	    </record>

	    <record model="ir.actions.act_window.view" id="action_triage_secretaire_tree_view">
		    <field eval="10" name="sequence"/>
		    <field name="view_mode">tree</field>
		    <field name="view_id" ref="episode_medical_secretaire_tree"/>
		    <field name="act_window_id" ref="action_triage_secretaire"/>
	    </record>
	
	    <menuitem name="Triage" id="menu_triage_secretaire" parent="mz_medical_infirmier.medical_infirmier" action="action_triage_secretaire" groups="group_secretaire"/>
		
    </data>
</openerp>